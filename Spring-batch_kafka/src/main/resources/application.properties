# ============================================
# APPLICATION PROPERTIES
# Spring Boot Batch with Kafka Configuration
# ============================================

# ============================================
# APPLICATION INFO
# ============================================
spring.application.name=spring-batch-kafka-parallel
server.port=8080
server.servlet.context-path=/

# ============================================
# DATABASE CONFIGURATION
# ============================================

# MySQL Configuration
spring.datasource.url=jdbc:mysql://localhost:3326/batch_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Connection Pool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1200000

# JPA / Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.open-in-view=false

# ============================================
# SPRING BATCH CONFIGURATION
# ============================================
spring.batch.job.enabled=false
spring.batch.jdbc.initialize-schema=always
spring.batch.jdbc.isolation-level-for-create=default
spring.batch.jdbc.table-prefix=BATCH_

# Batch Job Parameters
batch.chunk.size=100
batch.thread.pool.size=10
batch.partition.grid.size=4

# ============================================
# KAFKA CONFIGURATION
# ============================================

# Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092

# Kafka Producer Configuration
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5
spring.kafka.producer.properties.enable.idempotence=true
spring.kafka.producer.properties.linger.ms=10
spring.kafka.producer.properties.batch.size=16384
spring.kafka.producer.properties.buffer.memory=33554432
spring.kafka.producer.properties.compression.type=snappy

# Kafka Consumer Configuration
spring.kafka.consumer.group-id=batch-consumer-group
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.max-poll-records=100
spring.kafka.consumer.properties.spring.json.trusted.packages=*
spring.kafka.consumer.properties.session.timeout.ms=30000
spring.kafka.consumer.properties.heartbeat.interval.ms=10000
spring.kafka.consumer.properties.max.poll.interval.ms=300000

# Kafka Listener Configuration
spring.kafka.listener.ack-mode=manual
spring.kafka.listener.concurrency=3
spring.kafka.listener.poll-timeout=3000

# Kafka Topics (IMPORTANT!)
kafka.topics.customer=customer-topic
kafka.topics.customer-batch=customer-batch-topic
kafka.topics.customer-dlq=customer-topic-dlq
kafka.consumer.concurrency=3

# ============================================
# ACTUATOR & MONITORING
# ============================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,beans,env,loggers
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
management.metrics.export.prometheus.enabled=true

# ============================================
# LOGGING CONFIGURATION
# ============================================
logging.level.root=INFO
logging.level.com.example.batch=DEBUG
logging.level.org.springframework.batch=INFO
logging.level.org.springframework.kafka=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Logging Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log File Configuration
logging.file.name=logs/spring-batch-kafka.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=1GB

# ============================================
# SPRING RETRY CONFIGURATION
# ============================================
spring.retry.max-attempts=3
spring.retry.initial-interval=1000
spring.retry.multiplier=2.0
spring.retry.max-interval=10000

# ============================================
# RESILIENCE4J CONFIGURATION (Optional)
# ============================================

# Circuit Breaker
resilience4j.circuitbreaker.instances.batchService.sliding-window-size=10
resilience4j.circuitbreaker.instances.batchService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.batchService.wait-duration-in-open-state=60000
resilience4j.circuitbreaker.instances.batchService.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.batchService.automatic-transition-from-open-to-half-open-enabled=true

# Retry
resilience4j.retry.instances.batchService.max-attempts=3
resilience4j.retry.instances.batchService.wait-duration=1000
resilience4j.retry.instances.batchService.enable-exponential-backoff=true
resilience4j.retry.instances.batchService.exponential-backoff-multiplier=2

# Rate Limiter
resilience4j.ratelimiter.instances.batchService.limit-for-period=100
resilience4j.ratelimiter.instances.batchService.limit-refresh-period=1s
resilience4j.ratelimiter.instances.batchService.timeout-duration=0

# ============================================
# CACHE CONFIGURATION (Optional)
# ============================================
spring.cache.type=caffeine
spring.cache.cache-names=customers,batches
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=600s

# ============================================
# ASYNC CONFIGURATION
# ============================================
spring.task.execution.pool.core-size=10
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=batch-async-

# ============================================
# API DOCUMENTATION (Swagger/OpenAPI)
# ============================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha

# ============================================
# FILE UPLOAD CONFIGURATION
# ============================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
spring.servlet.multipart.file-size-threshold=2KB

# ============================================
# CUSTOM BATCH PROPERTIES
# ============================================

# CSV File Configuration
batch.csv.input-file=src/main/resources/customers.csv
batch.csv.output-directory=output/
batch.csv.error-directory=errors/

# Batch Processing Settings
batch.processing.enabled=true
batch.processing.parallel.enabled=true
batch.processing.partition.size=1000
batch.processing.chunk-size=100
batch.processing.skip-limit=10
batch.processing.retry-limit=3

# Dead Letter Queue
batch.kafka.dlq.enabled=true
batch.kafka.dlq.topic=customer-topic-dlq
batch.kafka.dlq.max-retries=3

# ============================================
# DISTRIBUTED TRACING (Optional)
# ============================================
management.tracing.sampling.probability=1.0
management.zipkin.tracing.endpoint=http://localhost:9411/api/v2/spans

# ============================================
# TIMEZONE & LOCALE
# ============================================
spring.jackson.time-zone=UTC
spring.jackson.date-format=yyyy-MM-dd'T'HH:mm:ss.SSSZ
spring.jackson.serialization.write-dates-as-timestamps=false

# ============================================
# PROFILE SPECIFIC CONFIGURATION
# ============================================
# Active Profile
spring.profiles.active=dev